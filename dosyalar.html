<!doctype html>
<html lang="tr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dosya ƒ∞ndirme Merkezi</title>

    <!-- CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap-icons.css" rel="stylesheet">
    <link href="css/tooplate-kool-form-pack.css" rel="stylesheet">

    <style>
      .search-wrap { max-width: 560px; margin: 0 auto; }
      .download-card { transition: transform .15s ease, box-shadow .15s ease; }
      .download-card:hover { transform: translateY(-2px); box-shadow: 0 10px 24px rgba(0,0,0,.08); }
      .muted-sm { font-size:.9rem; opacity:.8; }
      .spinner { display:inline-block; width:1.25rem; height:1.25rem; border:.2rem solid rgba(255,255,255,.35); border-top-color:#fff; border-radius:50%; animation: spin 0.8s linear infinite; }
      @keyframes spin { to { transform: rotate(360deg); } }
    </style>
  </head>
  <body>
    <main>
      <section class="hero-section hero-bg d-flex justify-content-center align-items-center">
        <div class="container">
          <div class="row">
            <div class="col-lg-10 col-12 text-center mx-auto">
              <h2 class="mb-3">üìÇ Dosya ƒ∞ndirme Merkezi</h2>
              <p class="mb-4">Bu sayfa <code>/dosyalar</code> klas√∂r√ºndeki dosyalarƒ± otomatik listeler.</p>

              <!-- Arama -->
              <div class="search-wrap input-group mb-4">
                <span class="input-group-text"><i class="bi-search"></i></span>
                <input id="searchInput" type="text" class="form-control" placeholder="Dosya ara (isim/uzantƒ±)">
                <button id="clearBtn" class="btn btn-outline-secondary" type="button">Temizle</button>
              </div>

              <!-- Liste -->
              <div id="list" class="list-group text-start"></div>

              <!-- Durum -->
              <div id="status" class="mt-4 muted-sm"></div>

              <a class="custom-btn btn mt-5" href="index.html">‚¨ÖÔ∏è Ana Sayfa</a>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- JS -->
    <script src="js/bootstrap.bundle.min.js"></script>
    <script>
      // ======= Ayarlar (repo bilgilerin) =======
      const OWNER  = "barisha-app";
      const REPO   = "BY-TAKI";
      const BRANCH = "main";
      const PATH   = "dosyalar"; // dosyalarƒ± koyduƒüun klas√∂r

      // GitHub API endpoint'i
      const API_URL = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${PATH}?ref=${BRANCH}`;

      const listEl   = document.getElementById("list");
      const statusEl = document.getElementById("status");
      const searchEl = document.getElementById("searchInput");
      const clearBtn = document.getElementById("clearBtn");

      // Basit ikon se√ßici
      function fileIcon(name) {
        const ext = (name.split(".").pop() || "").toLowerCase();
        if (["png","jpg","jpeg","gif","webp","svg"].includes(ext)) return "bi-file-image";
        if (["mp4","mov","mkv","webm"].includes(ext)) return "bi-file-earmark-play";
        if (["mp3","wav","aac","m4a","flac"].includes(ext)) return "bi-file-music";
        if (["pdf"].includes(ext)) return "bi-file-earmark-pdf";
        if (["doc","docx","odt","rtf"].includes(ext)) return "bi-file-earmark-word";
        if (["xls","xlsx","csv","ods"].includes(ext)) return "bi-file-earmark-spreadsheet";
        if (["ppt","pptx"].includes(ext)) return "bi-file-earmark-ppt";
        if (["zip","rar","7z","tar","gz"].includes(ext)) return "bi-file-zip";
        if (["m3u","m3u8","txt","md","json"].includes(ext)) return "bi-file-earmark-text";
        return "bi-file-earmark";
      }

      // Boyutu okunur hale getir
      function humanSize(bytes) {
        if (bytes == null) return "";
        const units = ["B","KB","MB","GB","TB"];
        let i=0, num=bytes;
        while (num >= 1024 && i < units.length-1) { num /= 1024; i++; }
        return num.toFixed(num < 10 && i>0 ? 1 : 0) + " " + units[i];
        }

      // Liste √∂ƒüesi olu≈ütur
      function makeItem({name, path, size, download_url}) {
        // GitHub Pages‚Äôda dosyaya g√∂rece link de verebilirsin:
        const relativeHref = `${PATH}/${encodeURIComponent(name)}`;
        // Veya doƒürudan raw link: download_url
        const href = relativeHref; // istersen 'download_url' yapabilirsin

        const li = document.createElement("a");
        li.className = "list-group-item list-group-item-action d-flex justify-content-between align-items-center download-card";
        li.href = href;
        li.setAttribute("download", "");
        li.innerHTML = `
          <span class="d-flex align-items-center gap-2">
            <i class="bi ${fileIcon(name)}"></i>
            <strong>${name}</strong>
          </span>
          <span class="badge bg-primary rounded-pill">${humanSize(size) || "ƒ∞ndir"}</span>
        `;
        return li;
      }

      // Durum yaz
      function setStatus(msg, loading=false) {
        statusEl.innerHTML = loading ? `<span class="spinner me-2"></span>${msg}` : msg;
      }

      // Veriyi getir & render et
      async function loadFiles() {
        try {
          setStatus("Dosyalar y√ºkleniyor...", true);
          const res = await fetch(API_URL, { headers: { "Accept": "application/vnd.github+json" }});
          if (!res.ok) {
            throw new Error("GitHub API hatasƒ±: " + res.status);
          }
          const data = await res.json();

          // Sadece dosya olanlarƒ± al (klas√∂rleri at)
          const files = data.filter(item => item.type === "file");

          // Hi√ß dosya yoksa
          if (!files.length) {
            setStatus("Bu klas√∂rde hen√ºz dosya yok. L√ºtfen depoda '/dosyalar' klas√∂r√ºne dosya y√ºkleyin.");
            return;
          }

          // ƒ∞sim sƒ±ralƒ±
          files.sort((a,b) => a.name.localeCompare(b.name, "tr"));

          // Render
          listEl.innerHTML = "";
          files.forEach(f => listEl.appendChild(makeItem(f)));
          setStatus(`Toplam ${files.length} dosya listelendi.`);
          
          // Arama
          searchEl.addEventListener("input", () => filter(files));
          clearBtn.addEventListener("click", () => { searchEl.value=""; filter(files); });
        } catch (err) {
          console.error(err);
          setStatus("Dosyalar y√ºklenemedi. ƒ∞nternet/GitHub eri≈üimini kontrol edin.");
        }
      }

      function filter(files) {
        const q = searchEl.value.trim().toLowerCase();
        const items = [...listEl.children];
        let shown = 0;
        files.forEach((f, i) => {
          const match = !q || f.name.toLowerCase().includes(q);
          items[i].style.display = match ? "" : "none";
          if (match) shown++;
        });
        setStatus(q ? `${shown} sonu√ß` : `Toplam ${files.length} dosya listelendi.`);
      }

      loadFiles();
    </script>
  </body>
</html>
